<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ ØµÙˆØ± Ø­ÙÙ„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</title>
    <!-- Ø¥Ø¶Ø§ÙØ© Tailwind CSS Ø¹Ø¨Ø± CDN -->
    <link href="output.css" rel="stylesheet">
    <!-- Ø¥Ø¶Ø§ÙØ© Ø®Ø· Tajawal -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Ù…ÙƒØªØ¨Ø© SortableJS Ù„Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
    <!-- Ù…ÙƒØªØ¨Ø© Compressor.js Ù„Ø¶ØºØ· Ø§Ù„ØµÙˆØ± -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/compressorjs/1.2.1/compressor.min.js"></script>
    <!-- Ù…ÙƒØªØ¨Ø© Typed.js Ù„ØªØ£Ø«ÙŠØ± Typewriter -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
</head>
<body>
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠ -->
    <div class="slideshow-container" id="slideshowContainer"></div>
    <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
    <div class="footer" id="mainFooter"></div>
    <!-- Ø²Ø± ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="settings-toggle-btn" id="settingsToggleBtn">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="settings-panel" id="settingsPanel">
        <h2 class="text-2xl font-bold mb-4 text-gray-100">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</h2>
        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© -->
        <div class="preview-pane mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø±ÙŠØ­Ø©</h3>
            <div id="slidePreview" class="w-full h-40 bg-gray-800 rounded"></div>
        </div>
        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
            <label for="backgroundImageUrlInput">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©:</label>
            <input type="text" id="backgroundImageUrlInput" placeholder="Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹">
            <input type="file" id="backgroundFileInput" accept="image/*" class="mt-2 text-sm">
            <img id="backgroundPreview" class="image-preview" style="display: none;">
            <button id="updateBackgroundBtn" class="bg-green-600 hover:bg-green-700">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠØ©</button>
        </div>
        <!-- Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø·Ø§Ù„Ø¨ -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø·Ø§Ù„Ø¨</h3>
            <label for="studentNameInput">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
            <input type="text" id="studentNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
            <label for="studentCommentInput">ØªØ¹Ù„ÙŠÙ‚:</label>
            <textarea id="studentCommentInput" placeholder="ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø¹Ù„Ù‰ ØªØ®Ø±Ø¬Ù‡!"></textarea>
            <label for="studentImageUrlInput">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
            <input type="text" id="studentImageUrlInput" placeholder="Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹">
            <input type="file" id="studentFileInput" accept="image/*" class="mt-2 text-sm">
            <img id="studentPreview" class="image-preview" style="display: none;">
            <label for="studentImageShapeInput">Ø´ÙƒÙ„ Ø§Ù„ØµÙˆØ±Ø©:</label>
            <select id="studentImageShapeInput" class="text-sm">
                <option value="circle">Ø¯Ø§Ø¦Ø±Ø© (ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡)</option>
                <option value="rectangle">Ù…Ø³ØªØ·ÙŠÙ„ (Ù…Ø«Ø§Ù„: 4x6)</option>
            </select>
            <button id="addStudentBtn" class="bg-indigo-600 hover:bg-indigo-700">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
        </div>
        <!-- Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ù†ØµÙŠØ© -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ù†ØµÙŠØ©</h3>
            <label for="textTitleInput">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
            <input type="text" id="textTitleInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø©">
            <label for="textCommentInput">Ø§Ù„Ù†Øµ:</label>
            <textarea id="textCommentInput" placeholder="Ù†Øµ Ø§Ù„Ø´Ø±ÙŠØ­Ø©"></textarea>
            <button id="addTextSlideBtn" class="bg-purple-600 hover:bg-purple-700">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ù†ØµÙŠØ©</button>
        </div>
        <!-- Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© ØµÙˆØ± Ø¹Ø§Ù…Ø© -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© ØµÙˆØ± Ø¹Ø§Ù…Ø©</h3>
            <label for="imageUrlInput">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:</label>
            <input type="text" id="imageUrlInput" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
            <input type="file" id="imageFileInput" accept="image/*" class="mt-2 text-sm">
            <img id="imagePreview" class="image-preview" style="display: none;">
            <label for="imageCaptionInput">ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="text" id="imageCaptionInput" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ± Ù„Ù„ØµÙˆØ±Ø©">
            <label for="imageTitleInput">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="text" id="imageTitleInput" placeholder="Ø¹Ù†ÙˆØ§Ù† ÙŠØ¸Ù‡Ø± Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©">
            <button id="addImageBtn" class="bg-orange-600 hover:bg-orange-700">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
        </div>
        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ© -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©</h3>
            <label for="backgroundMusicUrl">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØµÙˆØªÙŠØ© (MP3/WAV):</label>
            <input type="text" id="backgroundMusicUrl" placeholder="Ø£Ùˆ Ø§Ø±ÙØ¹ Ù…Ù„ÙØ§Ù‹">
            <input type="file" id="backgroundMusicFileInput" accept="audio/mp3,audio/wav" class="mt-2 text-sm">
            <div class="flex items-center gap-2 mt-2">
                <label for="musicVolume">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:</label>
                <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.5" class="flex-grow">
                <span id="volumeValue" class="text-sm">50%</span>
            </div>
            <div class="flex gap-2 mt-2">
                <button id="playMusicBtn" class="flex-1 bg-blue-500 hover:bg-blue-600">ØªØ´ØºÙŠÙ„</button>
                <button id="pauseMusicBtn" class="flex-1 bg-gray-500 hover:bg-gray-600">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
            </div>
            <audio id="backgroundMusic" loop></audio>
        </div>
        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø§Ù„ØªØ°ÙŠÙŠÙ„ (Ø§Ù„Ù‚Ø¯Ù…)</h3>
            <label for="footerTextInput">Ù†Øµ Ø§Ù„ØªØ°ÙŠÙŠÙ„:</label>
            <input type="text" id="footerTextInput" placeholder="Ù…Ø«Ø§Ù„: Ø­ÙÙ„Ø© ØªØ®Ø±Ø¬ Ø§Ù„Ø¯ÙØ¹Ø© 2024">
            <label for="footerTextColorInput">Ù„ÙˆÙ† Ù†Øµ Ø§Ù„ØªØ°ÙŠÙŠÙ„:</label>
            <input type="color" id="footerTextColorInput" value="#FFFFFF">
            <label for="footerBgColorInput">Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„ØªØ°ÙŠÙŠÙ„:</label>
            <input type="color" id="footerBgColorInput" value="#000000">
            <button id="updateFooterBtn" class="bg-teal-600 hover:bg-teal-700">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ°ÙŠÙŠÙ„</button>
        </div>
        <!-- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª</h3>
            <label for="slideDurationInput">Ù…Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ­Ø© (Ø«ÙˆØ§Ù†ÙŠ):</label>
            <input type="number" id="slideDurationInput" value="5" min="1">
            <label class="mt-4">ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„:</label>
            <div id="transitionEffects" class="grid grid-cols-2 gap-2 text-sm">
                <label><input type="checkbox" value="fade-in" checked> ØªÙ„Ø§Ø´ÙŠ</label>
                <label><input type="checkbox" value="slide-left"> Ø§Ù†Ø²Ù„Ø§Ù‚ Ù„Ù„ÙŠØ³Ø§Ø±</label>
                <label><input type="checkbox" value="slide-right"> Ø§Ù†Ø²Ù„Ø§Ù‚ Ù„Ù„ÙŠÙ…ÙŠÙ†</label>
                <label><input type="checkbox" value="zoom-in"> ØªÙƒØ¨ÙŠØ±</label>
                <label><input type="checkbox" value="rotate-in"> Ø¯ÙˆØ±Ø§Ù†</label>
                <label><input type="checkbox" value="slide-up"> ØµØ¹ÙˆØ¯ Ù„Ø£Ø¹Ù„Ù‰</label>
                <label><input type="checkbox" value="ken-burns"> ØªØ£Ø«ÙŠØ± Ken Burns</label>
                <label><input type="checkbox" value="blur-in"> Ø¯Ø®ÙˆÙ„ Ø¶Ø¨Ø§Ø¨ÙŠ</label>
            </div>
            <button id="applyTransitionEffectsBtn" class="bg-blue-500 hover:bg-blue-600">ØªØ·Ø¨ÙŠÙ‚ ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„</button>
        </div>
        <!-- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠ -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2 text-gray-200">Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠ</h3>
            <button id="startSlideshowBtn" class="bg-green-600 hover:bg-green-700">Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶</button>
            <button id="stopSlideshowBtn" class="bg-red-600 hover:bg-red-700">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø±Ø¶</button>
            <button id="fullscreenBtn" class="bg-blue-600 hover:bg-blue-700">ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
        </div>
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù…Ø³Ø­ -->
        <button id="saveSettingsBtn" class="bg-blue-600 hover:bg-blue-700">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button id="loadDefaultsBtn" class="bg-yellow-600 hover:bg-yellow-700">ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</button>
        <button id="clearAllBtn" class="bg-red-600 hover:bg-red-700">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­</button>
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
        <div class="slides-list" id="slidesList">
            <h3 class="font-semibold text-lg mb-2">Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ù…Ø¶Ø§ÙØ©:</h3>
        </div>
        <!-- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
        <div class="mb-4 p-3 border rounded-lg">
            <h3 class="font-semibold text-lg mb-2">ØªÙˆÙ„ÙŠØ¯ Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
            <button id="generateFinalBtn" class="bg-purple-600 hover:bg-purple-700 w-full">ØªÙˆÙ„ÙŠØ¯ Ù†Ø³Ø®Ø© Ø¨Ø¯ÙˆÙ† Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ…</button>
            <p class="text-sm text-gray-400 mt-2">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ø³ØªÙ‚Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·</p>
        </div>
        <!-- Ø­ÙØ¸/ØªØ­Ù…ÙŠÙ„ JSON -->
        <div class="flex flex-wrap justify-between gap-2 mt-4">
            <button id="exportSettingsBtn" class="bg-purple-600 hover:bg-purple-700 flex-grow">Ø­ÙØ¸ Ø§Ù„Ø¹Ø±Ø¶ (JSON)</button>
            <input type="file" id="loadFileInput" accept=".json" class="hidden">
            <button id="loadFromFileBtn" class="bg-teal-600 hover:bg-teal-700 flex-grow">ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ù…Ù„Ù (JSON)</button>
        </div>
    </div>
    <!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
    <div class="message-box" id="messageBox"></div>
</body>
</html>


<style>
    body {
        font-family: 'Tajawal', sans-serif;
        background-color: #f0f4f8;
        overflow-x: hidden;
        margin: 0;
        padding: 0;
        color: #333;
    }
    .slideshow-container {
        position: relative;
        height: 100vh;
        width: 100%;
        overflow: hidden;
        background-color: #000;
    }
    .slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        background-size: cover;
        background-position: center;
        transition: all 1s ease-in-out;
    }
    .slide.active {
        opacity: 1;
        z-index: 1;
    }
    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ */
    .slide.fade-in { animation: fadeIn 1s forwards; }
    .slide.slide-left { transform: translateX(100%); }
    .slide.active.slide-left { animation: slideInLeft 1s forwards; }
    .slide.slide-right { transform: translateX(-100%); }
    .slide.active.slide-right { animation: slideInRight 1s forwards; }
    .slide.zoom-in { transform: scale(0.5); opacity: 0; }
    .slide.active.zoom-in { animation: zoomIn 1s forwards; }
    .slide.rotate-in { transform: rotateY(90deg); opacity: 0; }
    .slide.active.rotate-in { animation: rotateIn 1s forwards; }
    .slide.slide-up { transform: translateY(100%); opacity: 0; }
    .slide.active.slide-up { animation: slideUp 1s forwards; }
    .slide.ken-burns { animation: kenBurns 10s infinite; }
    .slide.blur-in { filter: blur(10px); opacity: 0; }
    .slide.active.blur-in { animation: blurIn 1s forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideInLeft { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes slideInRight { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes rotateIn { from { transform: rotateY(90deg); opacity: 0; } to { transform: rotateY(0deg); opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes kenBurns { 0% { transform: scale(1) translate(0, 0); } 100% { transform: scale(1.2) translate(-10%, -10%); } }
    @keyframes blurIn { from { filter: blur(10px); opacity: 0; } to { filter: blur(0); opacity: 1; } }
    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        margin-top: -22px;
        color: white;
        font-weight: bold;
        font-size: 18px;
        transition: 0.6s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 10;
    }
    .next { right: 0; border-radius: 3px 0 0 3px; }
    .prev:hover, .next:hover { background-color: rgba(0, 0, 0, 0.8); }
    .dots-container {
        text-align: center;
        position: absolute;
        bottom: 20px;
        width: 100%;
        z-index: 10;
    }
    .dot {
        cursor: pointer;
        height: 15px;
        width: 15px;
        margin: 0 2px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
        transition: background-color 0.6s ease;
    }
    .dot.active, .dot:hover { background-color: #717171; }
    .slide.text-slide {
        background-color: rgba(0, 0, 0, 0.6);
        padding: 20px;
        text-align: center;
    }
    .slide.text-slide h2 { font-size: 3em; margin-bottom: 20px; }
    .slide.text-slide p { font-size: 1.5em; }
    .slide.student-slide {
        flex-direction: column;
        text-align: center;
        justify-content: center;
        align-items: center;
        background-color: rgba(0, 0, 0, 0.6);
    }
    .slide.student-slide img {
        display: block;
        margin: 0 auto 20px auto;
        border: 5px solid white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    .student-image.circle { border-radius: 50%; width: 250px; height: 250px; object-fit: cover; }
    .student-image.rectangle { width: 250px; height: 375px; object-fit: cover; }
    .slide.image-slide {
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .slide.image-slide .image-caption {
        position: absolute;
        bottom: 50px;
        background-color: rgba(0, 0, 0, 0.7);
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 1.2em;
    }
    .settings-panel {
        position: fixed;
        top: 0;
        left: 0;
        width: 350px;
        max-width: 90vw;
        height: 100vh;
        background-color: #2d3748;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
        padding: 20px;
        overflow-y: auto;
        z-index: 20;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        color: #e2e8f0;
    }
    .settings-panel.open { transform: translateX(0); }
    .settings-toggle-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 21;
        background-color: #4a5568;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    .settings-toggle-btn:hover { background-color: #2d3748; }
    .settings-panel label { display: block; margin-bottom: 5px; font-weight: bold; color: #cbd5e0; }
    .settings-panel input[type="text"],
    .settings-panel input[type="number"],
    .settings-panel textarea,
    .settings-panel select,
    .settings-panel input[type="color"] {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #4a5568;
        border-radius: 4px;
        box-sizing: border-box;
        background-color: #1a202c;
        color: #e2e8f0;
    }
    .settings-panel input[type="file"] { color: #cbd5e0; }
    .settings-panel button {
        background-color: #4299e1;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
    }
    .settings-panel button:hover { background-color: #3182ce; }
    .settings-panel button.bg-green-600 { background-color: #38a169; }
    .settings-panel button.bg-green-600:hover { background-color: #2f855a; }
    .settings-panel button.bg-indigo-600 { background-color: #667eea; }
    .settings-panel button.bg-indigo-600:hover { background-color: #5a67d8; }
    .settings-panel button.bg-purple-600 { background-color: #805ad5; }
    .settings-panel button.bg-purple-600:hover { background-color: #6b46c1; }
    .settings-panel button.bg-orange-600 { background-color: #ed8936; }
    .settings-panel button.bg-orange-600:hover { background-color: #dd6b20; }
    .settings-panel button.bg-blue-500 { background-color: #4299e1; }
    .settings-panel button.bg-blue-500:hover { background-color: #3182ce; }
    .settings-panel button.bg-gray-500 { background-color: #a0aec0; }
    .settings-panel button.bg-gray-500:hover { background-color: #718096; }
    .settings-panel button.bg-teal-600 { background-color: #319795; }
    .settings-panel button.bg-teal-600:hover { background-color: #2c7a7b; }
    .settings-panel button.bg-yellow-600 { background-color: #d69e2e; }
    .settings-panel button.bg-yellow-600:hover { background-color: #b7791f; }
    .settings-panel button.bg-red-600 { background-color: #e53e3e; }
    .settings-panel button.bg-red-600:hover { background-color: #c53030; }
    .slides-list { margin-top: 20px; border-top: 1px solid #4a5568; padding-top: 10px; }
    .slides-list div {
        background-color: #1a202c;
        padding: 8px;
        margin-bottom: 5px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9em;
        color: #e2e8f0;
        border: 1px solid #4a5568;
        cursor: move;
    }
    .slides-list .slide-item-content {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-grow: 1;
    }
    .slides-list .slide-thumbnail {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 4px;
        border: 1px solid #667eea;
    }
    .slides-list .slide-thumbnail.circle { border-radius: 50%; }
    .slides-list .slide-controls button {
        width: auto;
        margin-left: 5px;
        padding: 5px 8px;
        font-size: 0.8em;
    }
    .slides-list .slide-controls button.edit-btn { background-color: #d69e2e; }
    .slides-list .slide-controls button.edit-btn:hover { background-color: #b7791f; }
    .slides-list .slide-controls button.move-btn { background-color: #4299e1; }
    .slides-list .slide-controls button:hover { opacity: 0.8; }
    .message-box {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 100;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        font-size: 0.9em;
    }
    .message-box.show { opacity: 1; }
    .image-preview {
        max-width: 100%;
        max-height: 150px;
        display: block;
        margin-top: 10px;
        border: 1px solid #4a5568;
        border-radius: 4px;
    }
    .footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 0;
        text-align: center;
        font-size: 1em;
        z-index: 15;
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    .settings-panel .p-3.border.rounded-lg {
        background-color: #1a202c;
        border-color: #4a5568;
    }
    .settings-panel .p-3.border.rounded-lg h3 { color: #cbd5e0; }
    .settings-panel .p-3.border.rounded-lg label { color: #a0aec0; }
    .settings-panel .p-3.border.rounded-lg input,
    .settings-panel .p-3.border.rounded-lg textarea,
    .settings-panel .p-3.border.rounded-lg select {
        background-color: #2d3748;
        color: #e2e8f0;
        border-color: #4a5568;
    }
    .settings-panel .p-3.border.rounded-lg input[type="file"] { color: #a0aec0; }
    .settings-panel .p-3.border.rounded-lg button { background-color: #4299e1; color: white; }
    .preview-pane { background-color: #1a202c; padding: 10px; border-radius: 4px; }
    #slidePreview { display: flex; justify-content: center; align-items: center; overflow: hidden; }
</style>

<script>
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const slideshowContainer = document.getElementById('slideshowContainer');
    const settingsToggleBtn = document.getElementById('settingsToggleBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const startSlideshowBtn = document.getElementById('startSlideshowBtn');
    const stopSlideshowBtn = document.getElementById('stopSlideshowBtn');
    const studentNameInput = document.getElementById('studentNameInput');
    const studentCommentInput = document.getElementById('studentCommentInput');
    const studentImageUrlInput = document.getElementById('studentImageUrlInput');
    const studentFileInput = document.getElementById('studentFileInput');
    const studentPreview = document.getElementById('studentPreview');
    const studentImageShapeInput = document.getElementById('studentImageShapeInput');
    const addStudentBtn = document.getElementById('addStudentBtn');
    const textTitleInput = document.getElementById('textTitleInput');
    const textCommentInput = document.getElementById('textCommentInput');
    const addTextSlideBtn = document.getElementById('addTextSlideBtn');
    const imageUrlInput = document.getElementById('imageUrlInput');
    const imageFileInput = document.getElementById('imageFileInput');
    const imagePreview = document.getElementById('imagePreview');
    const imageCaptionInput = document.getElementById('imageCaptionInput');
    const imageTitleInput = document.getElementById('imageTitleInput');
    const addImageBtn = document.getElementById('addImageBtn');
    const slideDurationInput = document.getElementById('slideDurationInput');
    const saveSettingsBtn = document.getElementById('saveSettingsBtn');
    const loadDefaultsBtn = document.getElementById('loadDefaultsBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const exportSettingsBtn = document.getElementById('exportSettingsBtn');
    const loadFileInput = document.getElementById('loadFileInput');
    const loadFromFileBtn = document.getElementById('loadFromFileBtn');
    const slidesList = document.getElementById('slidesList');
    const messageBox = document.getElementById('messageBox');
    const backgroundImageUrlInput = document.getElementById('backgroundImageUrlInput');
    const backgroundFileInput = document.getElementById('backgroundFileInput');
    const backgroundPreview = document.getElementById('backgroundPreview');
    const updateBackgroundBtn = document.getElementById('updateBackgroundBtn');
    const backgroundMusicElement = document.getElementById('backgroundMusic');
    const backgroundMusicUrlInput = document.getElementById('backgroundMusicUrl');
    const backgroundMusicFileInput = document.getElementById('backgroundMusicFileInput');
    const musicVolumeControl = document.getElementById('musicVolume');
    const volumeValue = document.getElementById('volumeValue');
    const playMusicBtn = document.getElementById('playMusicBtn');
    const pauseMusicBtn = document.getElementById('pauseMusicBtn');
    const mainFooter = document.getElementById('mainFooter');
    const footerTextInput = document.getElementById('footerTextInput');
    const footerTextColorInput = document.getElementById('footerTextColorInput');
    const footerBgColorInput = document.getElementById('footerBgColorInput');
    const updateFooterBtn = document.getElementById('updateFooterBtn');
    const transitionEffectsContainer = document.getElementById('transitionEffects');
    const applyTransitionEffectsBtn = document.getElementById('applyTransitionEffectsBtn');
    const generateFinalBtn = document.getElementById('generateFinalBtn');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    let slides = [];
    let currentSlideIndex = 0;
    let slideshowInterval;
    let slideDuration = 5000;
    let selectedTransitionEffects = ['fade-in'];
    const allTransitionEffects = [
        'fade-in', 'slide-left', 'slide-right', 'zoom-in', 'rotate-in',
        'slide-up', 'ken-burns', 'blur-in'
    ];

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    function displayMessage(message, isError = false) {
        messageBox.textContent = message;
        messageBox.style.backgroundColor = isError ? 'rgba(220, 53, 69, 0.8)' : 'rgba(0, 0, 0, 0.8)';
        messageBox.classList.add('show');
        setTimeout(() => messageBox.classList.remove('show'), 3000);
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
    function validateMediaUrl(url, type, callback) {
        if (url.startsWith('data:')) return callback(true);
        const element = type === 'image' ? new Image() : new Audio();
        element.src = url;
        element.onloadedmetadata = element.onload = () => callback(true);
        element.onerror = () => callback(false);
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
    function handleFileUpload(fileInput, urlInput, previewElement = null) {
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    displayMessage('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ù‚Ù„ Ù…Ù† 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.', true);
                    fileInput.value = '';
                    return;
                }
                const reader = new FileReader();
                reader.onload = (event) => {
                    urlInput.value = event.target.result;
                    if (previewElement) {
                        previewElement.src = event.target.result;
                        previewElement.style.display = 'block';
                    }
                    if (fileInput.id === 'backgroundMusicFileInput') {
                        backgroundMusicElement.src = event.target.result;
                        backgroundMusicElement.play().catch(e => console.error("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰:", e));
                    }
                };
                reader.readAsDataURL(file);
            } else {
                urlInput.value = '';
                if (previewElement) {
                    previewElement.style.display = 'none';
                }
                if (fileInput.id === 'backgroundMusicFileInput') {
                    backgroundMusicElement.pause();
                    backgroundMusicElement.src = '';
                }
            }
        });
        urlInput.addEventListener('input', () => {
            if (urlInput.value) {
                validateMediaUrl(urlInput.value, urlInput.id.includes('Music') ? 'audio' : 'image', (isValid) => {
                    if (isValid) {
                        if (previewElement) {
                            previewElement.src = urlInput.value;
                            previewElement.style.display = 'block';
                        }
                        if (urlInput.id === 'backgroundMusicUrl') {
                            backgroundMusicElement.src = urlInput.value;
                            backgroundMusicElement.play().catch(e => console.error("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰:", e));
                        }
                    } else {
                        displayMessage('Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­.', true);
                        urlInput.value = '';
                        if (previewElement) previewElement.style.display = 'none';
                    }
                });
            } else {
                if (previewElement) previewElement.style.display = 'none';
                if (urlInput.id === 'backgroundMusicUrl') {
                    backgroundMusicElement.pause();
                    backgroundMusicElement.src = '';
                }
            }
        });
    }

    // Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
    function addStudent(name, comment, imageUrl, imageShape) {
        slides.push({ type: 'student', name, comment, imageUrl, imageShape, effect: selectedTransitionEffects[0] });
        updateSlidesList();
        displayMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­.');
    }
    function addTextSlide(title, comment) {
        slides.push({ type: 'text', title, comment, effect: selectedTransitionEffects[0] });
        updateSlidesList();
        displayMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ù†ØµÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.');
    }
    function addImage(imageUrl, caption = '', title = '') {
        slides.push({ type: 'image', imageUrl, caption, title, effect: selectedTransitionEffects[0] });
        updateSlidesList();
        displayMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.');
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
    function updateSlidesList() {
        slidesList.innerHTML = '<h3 class="font-semibold text-lg mb-2">Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ù…Ø¶Ø§ÙØ©:</h3>';
        if (slides.length === 0) {
            slidesList.innerHTML += '<p class="text-gray-400 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯.</p>';
        }
        slides.forEach((slide, index) => {
            const slideItem = document.createElement('div');
            let slideText = '';
            let thumbnailHtml = '';
            if (slide.type === 'student') {
                slideText = `Ø·Ø§Ù„Ø¨: ${slide.name}`;
                thumbnailHtml = `<img src="${slide.imageUrl}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨" class="slide-thumbnail ${slide.imageShape}" loading="lazy">`;
            } else if (slide.type === 'text') {
                slideText = `Ù†Øµ: ${slide.title || 'Ø´Ø±ÙŠØ­Ø© Ù†ØµÙŠØ©'}`;
                thumbnailHtml = `<span class="slide-thumbnail flex items-center justify-center bg-blue-700 text-white text-xs">Ù†Øµ</span>`;
            } else if (slide.type === 'image') {
                slideText = `ØµÙˆØ±Ø©: ${slide.caption || 'ØµÙˆØ±Ø© Ø¹Ø§Ù…Ø©'}`;
                thumbnailHtml = `<img src="${slide.imageUrl}" alt="ØµÙˆØ±Ø©" class="slide-thumbnail" loading="lazy">`;
            }
            slideItem.innerHTML = `
                <div class="slide-item-content">
                    ${thumbnailHtml}
                    <span>${index + 1}. ${slideText}</span>
                </div>
                <div class="slide-controls flex gap-1">
                    <button class="edit-btn bg-yellow-600 hover:bg-yellow-700" data-index="${index}" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ­Ø©">âœï¸</button>
                    <button class="move-btn bg-blue-500 hover:bg-blue-600" data-index="${index}" data-direction="up" title="Ù†Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰">â¬†ï¸</button>
                    <button class="move-btn bg-blue-500 hover:bg-blue-600" data-index="${index}" data-direction="down" title="Ù†Ù‚Ù„ Ù„Ù„Ø£Ø³ÙÙ„">â¬‡ï¸</button>
                    <button class="bg-red-600 hover:bg-red-700" data-index="${index}" title="Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙŠØ­Ø©">ğŸ—‘ï¸</button>
                </div>
            `;
            slidesList.appendChild(slideItem);
        });
        slidesList.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', (e) => {
                const index = parseInt(e.target.dataset.index);
                if (e.target.classList.contains('edit-btn')) {
                    const slide = slides[index];
                    if (slide.type === 'student') {
                        studentNameInput.value = slide.name;
                        studentCommentInput.value = slide.comment;
                        studentImageUrlInput.value = slide.imageUrl;
                        studentImageShapeInput.value = slide.imageShape;
                        studentPreview.src = slide.imageUrl;
                        studentPreview.style.display = 'block';
                    } else if (slide.type === 'text') {
                        textTitleInput.value = slide.title;
                        textCommentInput.value = slide.comment;
                    } else if (slide.type === 'image') {
                        imageUrlInput.value = slide.imageUrl;
                        imageCaptionInput.value = slide.caption;
                        imageTitleInput.value = slide.title;
                        imagePreview.src = slide.imageUrl;
                        imagePreview.style.display = 'block';
                    }
                    slides.splice(index, 1);
                    updateSlidesList();
                    showSlide(currentSlideIndex);
                    displayMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„. Ù‚Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ£Ø¶ÙÙ‡Ø§ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.');
                } else if (e.target.textContent.includes('ğŸ—‘ï¸')) {
                    slides.splice(index, 1);
                    if (currentSlideIndex >= slides.length && slides.length > 0) {
                        currentSlideIndex = slides.length - 1;
                    } else if (slides.length === 0) {
                        currentSlideIndex = 0;
                    }
                    displayMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙŠØ­Ø©.');
                    updateSlidesList();
                    showSlide(currentSlideIndex);
                } else if (e.target.dataset.direction === 'up') {
                    if (index > 0) {
                        [slides[index], slides[index - 1]] = [slides[index - 1], slides[index]];
                        if (currentSlideIndex === index) currentSlideIndex--;
                        else if (currentSlideIndex === index - 1) currentSlideIndex++;
                        displayMessage('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰.');
                        updateSlidesList();
                        showSlide(currentSlideIndex);
                    } else {
                        displayMessage('Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰.', true);
                    }
                } else if (e.target.dataset.direction === 'down') {
                    if (index < slides.length - 1) {
                        [slides[index], slides[index + 1]] = [slides[index + 1], slides[index]];
                        if (currentSlideIndex === index) currentSlideIndex++;
                        else if (currentSlideIndex === index + 1) currentSlideIndex--;
                        displayMessage('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ù„Ù„Ø£Ø³ÙÙ„.');
                        updateSlidesList();
                        showSlide(currentSlideIndex);
                    } else {
                        displayMessage('Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„.', true);
                    }
                }
            });
        });
        new Sortable(slidesList, {
            animation: 150,
            handle: '.slide-item-content',
            onEnd: (evt) => {
                const oldIndex = evt.oldIndex;
                const newIndex = evt.newIndex;
                const [movedSlide] = slides.splice(oldIndex, 1);
                slides.splice(newIndex, 0, movedSlide);
                if (currentSlideIndex === oldIndex) currentSlideIndex = newIndex;
                updateSlidesList();
                showSlide(currentSlideIndex);
                displayMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­.');
            }
        });
    }

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙŠØ­Ø©
function showSlide(index) {
    if (slides.length === 0) {
        slideshowContainer.innerHTML = '<div class="slide active flex flex-col justify-center items-center text-gray-400 text-2xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù„Ø¹Ø±Ø¶Ù‡Ø§. Ø£Ø¶Ù Ø´Ø±Ø§Ø¦Ø­ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ùˆ Ø­Ù…Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.</div>';
        document.querySelector('.prev')?.remove();
        document.querySelector('.next')?.remove();
        document.querySelector('.dots-container')?.remove();
        return;
    }
    slideshowContainer.innerHTML = '';
    const slideData = slides[index];
    const slideElement = document.createElement('div');
    slideElement.classList.add('slide');
    const storedSettings = JSON.parse(localStorage.getItem('slideshowSettings'));
    if (storedSettings && storedSettings.backgroundImageUrl) {
        slideElement.style.backgroundImage = `url('${storedSettings.backgroundImageUrl}')`;
    }
    if (slideData.type === 'student') {
        slideElement.classList.add('student-slide');
        slideElement.innerHTML = `
            <img src="${slideData.imageUrl}" alt="${slideData.name}" class="student-image ${slideData.imageShape}" loading="lazy">
            <div class="student-info p-4 bg-black/50 rounded-lg mt-4">
                <h2 class="text-4xl font-bold mb-2">${slideData.name}</h2>
                <p class="text-xl">${slideData.comment}</p>
            </div>
        `;
        slideshowContainer.appendChild(slideElement);
    } else if (slideData.type === 'text') {
        slideElement.classList.add('text-slide');
        slideElement.innerHTML = `
            <h2 id="text-title-${index}" class="text-4xl font-bold mb-4"></h2>
            <p id="text-comment-${index}" class="text-2xl"></p>
        `;
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ DOM Ø£ÙˆÙ„Ø§Ù‹
        slideshowContainer.appendChild(slideElement);
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆÙ‚ÙŠÙ… Ø§Ù„Ù†ØµÙˆØµ Ù‚Ø¨Ù„ ØªÙ‡ÙŠØ¦Ø© Typed.js
        const titleElement = document.querySelector(`#text-title-${index}`);
        const commentElement = document.querySelector(`#text-comment-${index}`);
        if (titleElement && (slideData.title || '').trim()) {
            new Typed(`#text-title-${index}`, { strings: [slideData.title || ''], typeSpeed: 50 });
        }
        if (commentElement && (slideData.comment || '').trim()) {
            new Typed(`#text-comment-${index}`, { strings: [slideData.comment || ''], typeSpeed: 50, startDelay: 1000 });
        }
    } else if (slideData.type === 'image') {
        slideElement.classList.add('image-slide');
        slideElement.style.backgroundImage = `url('${slideData.imageUrl}')`;
        slideElement.style.backgroundSize = 'contain';
        slideElement.style.backgroundRepeat = 'no-repeat';
        slideElement.style.backgroundPosition = 'center';
        if (slideData.title) {
            const titleElement = document.createElement('h2');
            titleElement.textContent = slideData.title;
            titleElement.style.position = 'absolute';
            titleElement.style.top = '50px';
            titleElement.style.zIndex = '1';
            titleElement.classList.add('text-4xl', 'font-bold');
            slideElement.appendChild(titleElement);
        }
        if (slideData.caption) {
            const captionElement = document.createElement('div');
            captionElement.classList.add('image-caption');
            captionElement.textContent = slideData.caption;
            slideElement.appendChild(captionElement);
        }
        slideshowContainer.appendChild(slideElement);
    }
    let effectToApply = selectedTransitionEffects[Math.floor(Math.random() * selectedTransitionEffects.length)] || 'fade-in';
    slideElement.classList.add('active', effectToApply);
    updateNavigationControls();
}

    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„
    function nextSlide() {
        currentSlideIndex = (currentSlideIndex + 1) % slides.length;
        showSlide(currentSlideIndex);
    }
    function prevSlide() {
        currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
        showSlide(currentSlideIndex);
    }

    // Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶
    function startSlideshow() {
        clearInterval(slideshowInterval);
        if (slides.length > 0) {
            slideDuration = parseInt(slideDurationInput.value) * 1000;
            slideshowInterval = setInterval(nextSlide, slideDuration);
            if (backgroundMusicElement.src) {
                backgroundMusicElement.currentTime = 0;
                backgroundMusicElement.play().catch(e => {
                    displayMessage('ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ù…ØªØµÙØ­ ØªÙØ§Ø¹Ù„Ø§Ù‹ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.', true);
                });
            }
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø±Ø¶
    function stopSlideshow() {
        clearInterval(slideshowInterval);
        backgroundMusicElement.pause();
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
    function updateNavigationControls() {
        let dotsContainer = document.querySelector('.dots-container');
        if (!dotsContainer) {
            dotsContainer = document.createElement('div');
            dotsContainer.classList.add('dots-container');
            slideshowContainer.appendChild(dotsContainer);
        }
        dotsContainer.innerHTML = '';
        if (slides.length > 0) {
            for (let i = 0; i < slides.length; i++) {
                const dot = document.createElement('span');
                dot.classList.add('dot');
                if (i === currentSlideIndex) dot.classList.add('active');
                dot.addEventListener('click', () => {
                    currentSlideIndex = i;
                    showSlide(currentSlideIndex);
                    startSlideshow();
                });
                dotsContainer.appendChild(dot);
            }
            dotsContainer.style.display = 'block';
        } else {
            dotsContainer.style.display = 'none';
        }
        let prevBtn = document.querySelector('.prev');
        let nextBtn = document.querySelector('.next');
        if (slides.length > 0) {
            if (!prevBtn) {
                prevBtn = document.createElement('a');
                prevBtn.classList.add('prev');
                prevBtn.innerHTML = 'â®';
                prevBtn.addEventListener('click', () => {
                    prevSlide();
                    startSlideshow();
                });
                slideshowContainer.appendChild(prevBtn);
            }
            if (!nextBtn) {
                nextBtn = document.createElement('a');
                nextBtn.classList.add('next');
                nextBtn.innerHTML = 'â¯';
                nextBtn.addEventListener('click', () => {
                    nextSlide();
                    startSlideshow();
                });
                slideshowContainer.appendChild(nextBtn);
            }
            prevBtn.style.display = 'block';
            nextBtn.style.display = 'block';
        } else {
            if (prevBtn) prevBtn.style.display = 'none';
            if (nextBtn) nextBtn.style.display = 'none';
        }
    }

// Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Base64
function imageToBase64(url) {
    return new Promise((resolve) => {
        if (url.startsWith('data:')) {
            // Ø§Ù„ØµÙˆØ±Ø© Ù…Ø±Ù…Ø²Ø© ÙƒÙ€ Base64 Ø¨Ø§Ù„ÙØ¹Ù„
            resolve(url);
        } else if (url.startsWith('file://')) {
            // Ø±ÙˆØ§Ø¨Ø· file:// ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©
            console.error('File URLs (file://) are not supported. Please upload the image.');
            displayMessage('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· file://.', true);
            resolve('');
        } else {
            // Ø±ÙˆØ§Ø¨Ø· http Ø£Ùˆ https
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    new Compressor(blob, {
                        quality: 0.6,
                        maxWidth: 1920,
                        maxHeight: 1080,
                        success(compressedBlob) {
                            const reader = new FileReader();
                            reader.onloadend = () => resolve(reader.result);
                            reader.readAsDataURL(compressedBlob);
                        },
                        error(err) {
                            console.error('Error compressing image:', err);
                            displayMessage('Ø®Ø·Ø£: ÙØ´Ù„ Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø©. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ø®Ø±Ù‰.', true);
                            resolve('');
                        }
                    });
                })
                .catch(err => {
                    console.error('Error fetching image:', err);
                    displayMessage('Ø®Ø·Ø£: ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§.', true);
                    resolve('');
                });
        }
    });
}

// Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Base64
function audioToBase64(url) {
    return new Promise((resolve) => {
        if (url.startsWith('data:')) {
            // Ø§Ù„ØµÙˆØª Ù…Ø±Ù…Ø² ÙƒÙ€ Base64 Ø¨Ø§Ù„ÙØ¹Ù„
            resolve(url);
        } else if (url.startsWith('file://')) {
            // Ø±ÙˆØ§Ø¨Ø· file:// ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©
            console.error('File URLs (file://) are not supported. Please upload the audio.');
            displayMessage('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· file://.', true);
            resolve('');
        } else {
            // Ø±ÙˆØ§Ø¨Ø· http Ø£Ùˆ https
            fetch(url)
                .then(response => response.blob())
                .then(blob => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                })
                .catch(err => {
                    console.error('Error fetching audio:', err);
                    displayMessage('Ø®Ø·Ø£: ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ù…Ø­Ù„ÙŠÙ‹Ø§.', true);
                    resolve('');
                });
        }
    });
}

// Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù…Ø­Ø¯Ø«Ø© Ù„ØªØ£ÙƒÙŠØ¯ ØªØ±Ù…ÙŠØ² Ø§Ù„ØµÙˆØª)
function handleFileUpload(fileInput, urlInput, previewElement = null) {
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            if (file.size > 5 * 1024 * 1024) {
                displayMessage('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ù‚Ù„ Ù…Ù† 5 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.', true);
                fileInput.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onload = (event) => {
                urlInput.value = event.target.result; // ØªØ®Ø²ÙŠÙ† Base64
                if (previewElement) {
                    previewElement.src = event.target.result;
                    previewElement.style.display = 'block';
                }
                if (fileInput.id === 'backgroundMusicFileInput') {
                    backgroundMusicElement.src = event.target.result;
                    backgroundMusicElement.play().catch(e => console.error("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰:", e));
                }
            };
            reader.readAsDataURL(file);
        } else {
            urlInput.value = '';
            if (previewElement) {
                previewElement.style.display = 'none';
            }
            if (fileInput.id === 'backgroundMusicFileInput') {
                backgroundMusicElement.pause();
                backgroundMusicElement.src = '';
            }
        }
    });
}
    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠØ©
    function updateBackground() {
        const imageUrl = backgroundImageUrlInput.value.trim();
        const file = backgroundFileInput.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                slideshowContainer.style.backgroundImage = `url('${e.target.result}')`;
                slideshowContainer.style.backgroundSize = 'cover';
                slideshowContainer.style.backgroundPosition = 'center';
                slideshowContainer.style.backgroundRepeat = 'no-repeat';
                backgroundPreview.src = e.target.result;
                backgroundPreview.style.display = 'block';
                localStorage.setItem('slideshowSettings', JSON.stringify({ backgroundImageUrl: e.target.result }));
                displayMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† Ù…Ù„Ù.');
            };
            reader.readAsDataURL(file);
        } else if (imageUrl) {
            validateMediaUrl(imageUrl, 'image', (isValid) => {
                if (isValid) {
                    slideshowContainer.style.backgroundImage = `url('${imageUrl}')`;
                    slideshowContainer.style.backgroundSize = 'cover';
                    slideshowContainer.style.backgroundPosition = 'center';
                    slideshowContainer.style.backgroundRepeat = 'no-repeat';
                    backgroundPreview.src = imageUrl;
                    backgroundPreview.style.display = 'block';
                    localStorage.setItem('slideshowSettings', JSON.stringify({ backgroundImageUrl: imageUrl }));
                    displayMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† Ø±Ø§Ø¨Ø·.');
                } else {
                    displayMessage('Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ù„ÙÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­.', true);
                }
            });
        } else {
            slideshowContainer.style.backgroundImage = 'none';
            backgroundPreview.style.display = 'none';
            localStorage.removeItem('slideshowSettings');
            displayMessage('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø±Ø¶.');
        }
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ°ÙŠÙŠÙ„
    function updateFooter() {
        mainFooter.textContent = footerTextInput.value;
        mainFooter.style.color = footerTextColorInput.value;
        mainFooter.style.backgroundColor = footerBgColorInput.value;
        mainFooter.style.display = footerTextInput.value.trim() ? 'block' : 'none';
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    function getSelectedTransitionEffects() {
        const checkboxes = transitionEffectsContainer.querySelectorAll('input[type="checkbox"]:checked');
        return Array.from(checkboxes).map(cb => cb.value);
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
    function updateTransitionCheckboxes() {
        const checkboxes = transitionEffectsContainer.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.checked = selectedTransitionEffects.includes(cb.value);
        });
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    function loadDefaultSettings() {
        slides = [];
        backgroundImageUrlInput.value = 'background.jpg';
        updateBackground();
        backgroundMusicUrlInput.value = 'graduation.mp3';
        backgroundMusicElement.src = 'graduation.mp3';
        musicVolumeControl.value = 0.5;
        volumeValue.textContent = '50%';
        footerTextInput.value = 'Ø­ÙÙ„ ØªØ®Ø±Ø¬Ù†Ø§ 2024';
        footerTextColorInput.value = '#FFFFFF';
        footerBgColorInput.value = '#000000';
        updateFooter();
        selectedTransitionEffects = ['fade-in', 'slide-left'];
        updateTransitionCheckboxes();
        addStudent("Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ 1", "ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ®Ø±Ø¬!", "student1.jpg", "circle");
        addStudent("Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ 2", "Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø§Ù„ØªÙˆÙÙŠÙ‚!", "student2.jpg", "rectangle");
        addTextSlide("ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!", "Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø¯ÙˆØ§Ù… Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ù†Ø¬Ø§Ø­.");
        addImage('photo1.jpg', 'ØªØ¹Ù„Ù… ÙˆØ¥Ù„Ù‰ Ø§Ù„Ø¹Ù„ÙŠØ§Ø¡ ØªÙ‚Ø¯Ù…', 'Ø§Ù„Ø¹Ù„Ù… Ù†ÙˆØ±');
        slideDurationInput.value = 5;
        updateSlidesList();
        showSlide(0);
        startSlideshow();
        displayMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­.');
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
    function clearAllSlides() {
        slides = [];
        currentSlideIndex = 0;
        slideshowContainer.innerHTML = '<div class="slide active flex flex-col justify-center items-center text-gray-400 text-2xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù„Ø¹Ø±Ø¶Ù‡Ø§. Ø£Ø¶Ù Ø´Ø±Ø§Ø¦Ø­ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ùˆ Ø­Ù…Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.</div>';
        updateSlidesList();
        stopSlideshow();
        backgroundImageUrlInput.value = '';
        slideshowContainer.style.backgroundImage = 'none';
        backgroundPreview.style.display = 'none';
        backgroundMusicElement.src = '';
        musicVolumeControl.value = 0.5;
        volumeValue.textContent = '50%';
        footerTextInput.value = '';
        footerTextColorInput.value = '#FFFFFF';
        footerBgColorInput.value = '#000000';
        updateFooter();
        selectedTransitionEffects = ['fade-in'];
        updateTransitionCheckboxes();
        displayMessage('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.');
    }

    // Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ù„Ù‰ JSON
    function exportCurrentSettings() {
        const settingsToSave = {
            slides,
            background: { url: backgroundImageUrlInput.value },
            music: { url: backgroundMusicUrlInput.value, volume: musicVolumeControl.value },
            footer: {
                text: footerTextInput.value,
                textColor: footerTextColorInput.value,
                bgColor: footerBgColorInput.value
            },
            currentSlideIndex,
            slideDuration: slideDurationInput.value,
            transitionEffects: selectedTransitionEffects
        };
        const dataStr = JSON.stringify(settingsToSave, null, 4);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Ø¹Ø±Ø¶_Ø§Ù„Ù†Ø¬Ø§Ø­_Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        displayMessage('ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙƒÙ…Ù„Ù JSON.');
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† JSON
    function loadSettingsFromFile(event) {
        const file = event.target.files[0];
        if (!file) {
            displayMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…Ù„Ù JSON.', true);
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const settings = JSON.parse(e.target.result);
                if (settings && Array.isArray(settings.slides)) {
                    slides = settings.slides;
                    currentSlideIndex = settings.currentSlideIndex || 0;
                    backgroundImageUrlInput.value = settings.background?.url || '';
                    updateBackground();
                    backgroundMusicUrlInput.value = settings.music?.url || '';
                    musicVolumeControl.value = settings.music?.volume || 0.5;
                    volumeValue.textContent = `${Math.round((settings.music?.volume || 0.5) * 100)}%`;
                    if (settings.music?.url) backgroundMusicElement.src = settings.music.url;
                    footerTextInput.value = settings.footer?.text || '';
                    footerTextColorInput.value = settings.footer?.textColor || '#FFFFFF';
                    footerBgColorInput.value = settings.footer?.bgColor || '#000000';
                    updateFooter();
                    slideDurationInput.value = settings.slideDuration || 5;
                    selectedTransitionEffects = settings.transitionEffects || ['fade-in'];
                    updateTransitionCheckboxes();
                    updateSlidesList();
                    showSlide(currentSlideIndex);
                    startSlideshow();
                    displayMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    displayMessage('Ù…Ù„Ù JSON ØºÙŠØ± ØµØ§Ù„Ø­.', true);
                }
            } catch (error) {
                displayMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù.', true);
            }
        };
        reader.readAsText(file);
    }


// Ø¯Ø§Ù„Ø© Ù„Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø®Ø§ØµØ©
function escapeHtml(unsafe) {
    if (!unsafe) return '';
    return unsafe
        .replace(/&/g, "&")
        .replace(/</g, "<")
        .replace(/>/g, ">")
        .replace(/"/g, "\"")
        .replace(/'/g, "'");
}

// Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
// Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
async function generateFinalVersion() {
    try {
        displayMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø©...');

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙƒÙˆÙŠÙ†
        const config = {
            slides: [],
            background: {
                url: backgroundImageUrlInput.value,
                isLocal: backgroundFileInput.files.length > 0
            },
            music: {
                url: backgroundMusicUrlInput.value,
                isLocal: backgroundMusicFileInput.files.length > 0,
                volume: musicVolumeControl.value
            },
            footer: {
                text: footerTextInput.value,
                textColor: footerTextColorInput.value,
                bgColor: footerBgColorInput.value
            },
            settings: {
                duration: slideDurationInput.value,
                transitions: selectedTransitionEffects
            }
        };

        // ÙØ­Øµ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
        const checkFileSize = (fileInput, type) => {
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    displayMessage(`ØªØ­Ø°ÙŠØ±: Ø­Ø¬Ù… ${type} (${(file.size / (1024 * 1024)).toFixed(2)} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª) ÙƒØ¨ÙŠØ±. Ù‚Ø¯ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.`, true);
                }
            }
        };
        checkFileSize(backgroundFileInput, 'ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©');
        checkFileSize(backgroundMusicFileInput, 'Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØµÙˆØªÙŠØ©');

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
        for (const slide of slides) {
            const newSlide = { ...slide };
            if (slide.imageUrl) {
                if (slide.imageUrl.startsWith('data:')) {
                    newSlide.imageUrl = slide.imageUrl;
                } else if (slide.imageUrl.startsWith('file://')) {
                    displayMessage('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· file://.', true);
                    newSlide.imageUrl = '';
                } else {
                    newSlide.imageUrl = await imageToBase64(slide.imageUrl);
                }
            }
            newSlide.name = escapeHtml(newSlide.name);
            newSlide.comment = escapeHtml(newSlide.comment);
            newSlide.title = escapeHtml(newSlide.title);
            newSlide.caption = escapeHtml(newSlide.caption);
            newSlide.imageShape = escapeHtml(newSlide.imageShape);
            config.slides.push(newSlide);
        }

        // ØªØ­ÙˆÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©
        if (config.background.url) {
            if (config.background.url.startsWith('data:')) {
                config.background.url = config.background.url;
            } else if (config.background.url.startsWith('file://')) {
                displayMessage('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· file://.', true);
                config.background.url = '';
            } else {
                config.background.url = await imageToBase64(config.background.url);
            }
        }

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØµÙˆØªÙŠØ©
        if (config.music.url) {
            if (config.music.url.startsWith('data:')) {
                config.music.url = config.music.url;
            } else if (config.music.url.startsWith('file://')) {
                displayMessage('Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· file://.', true);
                config.music.url = '';
            } else {
                config.music.url = await audioToBase64(config.music.url);
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ HTML Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        const htmlContent = `
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ Ø§Ù„ØªØ®Ø±Ø¬ - Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <link href="output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script\>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-color: #000;
        }
        .slideshow-container {
            position: relative;
            height: 100vh;
            width: 100%;
            background-image: url('${config.background.url || ''}');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            transition: all 1s ease-in-out;
        }
        .slide.active {
            opacity: 1;
            z-index: 1;
        }
        .slide.fade-in { animation: fadeIn 1s forwards; }
        .slide.slide-left { transform: translateX(100%); }
        .slide.active.slide-left { animation: slideInLeft 1s forwards; }
        .slide.slide-right { transform: translateX(-100%); }
        .slide.active.slide-right { animation: slideInRight 1s forwards; }
        .slide.zoom-in { transform: scale(0.5); opacity: 0; }
        .slide.active.zoom-in { animation: zoomIn 1s forwards; }
        .slide.rotate-in { transform: rotateY(90deg); opacity: 0; }
        .slide.active.rotate-in { animation: rotateIn 1s forwards; }
        .slide.slide-up { transform: translateY(100%); opacity: 0; }
        .slide.active.slide-up { animation: slideUp 1s forwards; }
        .slide.ken-burns { animation: kenBurns 10s infinite; }
        .slide.blur-in { filter: blur(10px); opacity: 0; }
        .slide.active.blur-in { animation: blurIn 1s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInLeft { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideInRight { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes rotateIn { from { transform: rotateY(90deg); opacity: 0; } to { transform: rotateY(0deg); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes kenBurns { 0% { transform: scale(1) translate(0, 0); } 100% { transform: scale(1.2) translate(-10%, -10%); } }
        @keyframes blurIn { from { filter: blur(10px); opacity: 0; } to { filter: blur(0); opacity: 1; } }
        .prev, .next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            width: auto;
            padding: 16px;
            margin-top: -22px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            transition: 0.6s ease;
            border-radius: 0 3px 3px 0;
            user-select: none;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        .next { right: 0; border-radius: 3px 0 0 3px; }
        .prev:hover, .next:hover { background-color: rgba(0, 0, 0, 0.8); }
        .dots-container {
            text-align: center;
            position: absolute;
            bottom: 20px;
            width: 100%;
            z-index: 10;
        }
        .dot {
            cursor: pointer;
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbb;
            border-radius: 50%;
            display: inline-block;
            transition: background-color 0.6s ease;
        }
        .dot.active, .dot:hover { background-color: #717171; }
        .slide.text-slide {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 20px;
            text-align: center;
        }
        .slide.text-slide h2 { font-size: 3em; margin-bottom: 20px; }
        .slide.text-slide p { font-size: 1.5em; }
        .slide.student-slide {
            flex-direction: column;
            text-align: center;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.6);
        }
        .slide.student-slide img {
            display: block;
            margin: 0 auto 20px auto;
            border: 5px solid white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .student-image.circle { border-radius: 50%; width: 250px; height: 250px; object-fit: cover; }
        .student-image.rectangle { width: 250px; height: 375px; object-fit: cover; }
        .slide.image-slide {
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .slide.image-slide .image-caption {
            position: absolute;
            bottom: 50px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1.2em;
        }
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            padding: 12px;
            text-align: center;
            font-size: 1em;
            z-index: 10;
            color: ${escapeHtml(config.footer.textColor || '#fff')};
            background-color: ${escapeHtml(config.footer.bgColor || '#333')};
        }
    </style>
</head>
<body>
    <div class="slideshow-container" id="slideshowContainer"></div>
    <a class="prev" onclick="prevSlide()">â®</a>
    <a class="next" onclick="nextSlide()">â¯</a>
    <div class="dots-container"></div>
    <div class="footer" id="mainFooter">${escapeHtml(config.footer.text || '')}</div>
    <audio id="backgroundMusic" loop></audio>
    <script>
        const config = ${JSON.stringify(config, null, 4)};
        let currentSlideIndex = 0;
        let slideshowInterval;
        const container = document.getElementById('slideshowContainer');
        const footer = document.getElementById('mainFooter');
        const music = document.getElementById('backgroundMusic');
        function showSlide(index) {
            container.innerHTML = '';
            if (!config.slides.length) {
                container.innerHTML = '<div class="slide active flex flex-col justify-center items-center text-gray-400 text-2xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù„Ø¹Ø±Ø¶Ù‡Ø§.</div>';
                document.querySelector('.prev').style.display = 'none';
                document.querySelector('.next').style.display = 'none';
                document.querySelector('.dots-container').innerHTML = '';
                return;
            }
            const slide = config.slides[index];
            const slideEl = document.createElement('div');
            slideEl.classList.add('slide');
            const effects = config.settings.transitions || ['fade-in'];
            const effectToApply = effects[Math.floor(Math.random() * effects.length)];
            slideEl.classList.add(effectToApply, 'active');
            if (slide.type === 'student') {
                slideEl.classList.add('student-slide');
                slideEl.innerHTML = \`
                    <img src="\${slide.imageUrl || ''}" alt="\${slide.name || 'Ø·Ø§Ù„Ø¨'}" class="student-image \${slide.imageShape || 'circle'}" loading="lazy">
                    <div class="student-info p-4 bg-black/50 rounded-lg mt-4">
                        <h2 class="text-4xl font-bold mb-2">\${slide.name || ''}</h2>
                        <p class="text-xl">\${slide.comment || ''}</p>
                    </div>
                \`;
                container.appendChild(slideEl);
            } else if (slide.type === 'text') {
                slideEl.classList.add('text-slide');
                slideEl.innerHTML = \`
                    <h2 id="text-title-\${index}" class="text-4xl font-bold mb-4"></h2>
                    <p id="text-comment-\${index}" class="text-2xl"></p>
                \`;
                container.appendChild(slideEl);
                const titleElement = document.querySelector(\`#text-title-\${index}\`);
                const commentElement = document.querySelector(\`#text-comment-\${index}\`);
                if (titleElement && (slide.title || '').trim()) {
                    new Typed(\`#text-title-\${index}\`, { strings: [\`\${slide.title || ''}\`], typeSpeed: 50 });
                }
                if (commentElement && (slide.comment || '').trim()) {
                    new Typed(\`#text-comment-\${index}\`, { strings: [\`\${slide.comment || ''}\`], typeSpeed: 50, startDelay: 1000 });
                }
            } else if (slide.type === 'image') {
                slideEl.classList.add('image-slide');
                slideEl.style.backgroundImage = \`url('\${slide.imageUrl || ''}')\`;
                slideEl.style.backgroundSize = 'contain';
                slideEl.style.backgroundRepeat = 'no-repeat';
                slideEl.style.backgroundPosition = 'center';
                let slideContent = '';
                if (slide.title) {
                    slideContent += \`
                        <h2 class="text-4xl font-bold absolute top-[50px] z-[1] text-center w-full">\${slide.title}</h2>
                    \`;
                }
                if (slide.caption) {
                    slideContent += \`
                        <div class="image-caption absolute bottom-[50px] text-center w-full bg-black/70 p-2 rounded">\${slide.caption}</div>
                    \`;
                }
                slideEl.innerHTML = slideContent;
                container.appendChild(slideEl);
            }
            const dotsContainer = document.querySelector('.dots-container');
            dotsContainer.innerHTML = '';
            for (let i = 0; i < config.slides.length; i++) {
                const dot = document.createElement('span');
                dot.classList.add('dot');
                if (i === index) dot.classList.add('active');
                dot.addEventListener('click', () => {
                    currentSlideIndex = i;
                    showSlide(i);
                    startSlideshow();
                });
                dotsContainer.appendChild(dot);
            }
            document.querySelector('.prev').style.display = config.slides.length > 1 ? 'block' : 'none';
            document.querySelector('.next').style.display = config.slides.length > 1 ? 'block' : 'none';
        }
        function nextSlide() {
            currentSlideIndex = (currentSlideIndex + 1) % config.slides.length;
            showSlide(currentSlideIndex);
        }
        function prevSlide() {
            currentSlideIndex = (currentSlideIndex - 1 + config.slides.length) % config.slides.length;
            showSlide(currentSlideIndex);
        }
        function startSlideshow() {
            clearInterval(slideshowInterval);
            if (config.slides.length > 0) {
                if (config.music.url) {
                    music.src = config.music.url;
                    music.volume = config.music.volume || 0.5;
                    music.play().catch(() => console.log('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª.'));
                }
                slideshowInterval = setInterval(nextSlide, (config.settings.duration || 5) * 1000);
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            footer.textContent = config.footer.text || '';
            footer.style.color = config.footer.textColor || '#fff';
            footer.style.backgroundColor = config.footer.bgColor || '#333';
            footer.style.display = config.footer.text ? 'block' : 'none';
            showSlide(0);
            startSlideshow();
            document.addEventListener('click', () => {
                if (music.paused && music.src) music.play();
            }, { once: true });
        });
    </script\>
</body>
</html>
        `;

        // ØªÙ‚Ø¯ÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        const estimatedSizeBytes = new TextEncoder().encode(htmlContent).length;
        const estimatedSizeMB = estimatedSizeBytes / (1024 * 1024);
        if (estimatedSizeMB > 50) {
            displayMessage(`ØªØ­Ø°ÙŠØ±: Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (${estimatedSizeMB.toFixed(2)} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª) ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§. Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„ÙØ§Øª Ø£ØµØºØ± Ø­Ø¬Ù…Ù‹Ø§ Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­.`, true);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        const blob = new Blob([htmlContent], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Ø¹Ø±Ø¶_Ø§Ù„ØªØ®Ø±Ø¬_Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        displayMessage('ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    } catch (error) {
        console.error('Error generating final version:', error);
        displayMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.', true);
    }
}

// ØªØ¹Ø¯ÙŠÙ„ loadDefaultSettings Ù„ØªØ¬Ù†Ø¨ Ø±ÙˆØ§Ø¨Ø· file://
function loadDefaultSettings() {
    slides = [];
    backgroundImageUrlInput.value = ''; // Ù„Ø§ Ø±ÙˆØ§Ø¨Ø· file://
    backgroundMusicUrlInput.value = ''; // Ù„Ø§ Ø±ÙˆØ§Ø¨Ø· file://
    musicVolumeControl.value = 0.5;
    volumeValue.textContent = '50%';
    footerTextInput.value = 'Ø­ÙÙ„ ØªØ®Ø±Ø¬Ù†Ø§ 2024';
    footerTextColorInput.value = '#FFFFFF';
    footerBgColorInput.value = '#000000';
    updateFooter();
    selectedTransitionEffects = ['fade-in', 'slide-left'];
    updateTransitionCheckboxes();
    slideDurationInput.value = 5;
    updateSlidesList();
    slideshowContainer.innerHTML = '<div class="slide active flex flex-col justify-center items-center text-gray-400 text-2xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù„Ø¹Ø±Ø¶Ù‡Ø§. Ø£Ø¶Ù Ø´Ø±Ø§Ø¦Ø­ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</div>';
    displayMessage('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙŠØ¯ÙˆÙŠÙ‹Ø§.');
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©
function updateSlidePreview() {
    const preview = document.getElementById('slidePreview');
    if (studentNameInput.value && studentImageUrlInput.value) {
        preview.innerHTML = `
            <img src="${studentImageUrlInput.value}" class="student-image ${studentImageShapeInput.value}" style="width: 100px; height: ${studentImageShapeInput.value === 'circle' ? '100px' : '150px'}" loading="lazy">
            <h3 class="text-white text-sm">${studentNameInput.value}</h3>
        `;
    } else if (textTitleInput.value || textCommentInput.value) {
        preview.innerHTML = `
            <h3 class="text-white text-sm">${textTitleInput.value}</h3>
            <p class="text-white text-xs">${textCommentInput.value}</p>
        `;
    } else if (imageUrlInput.value) {
        preview.innerHTML = `<img src="${imageUrlInput.value}" class="w-full h-full object-contain" loading="lazy">`;
    } else {
        preview.innerHTML = '<p class="text-gray-400 text-sm">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</p>';
    }
}

// Ø¯Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„
function enableAudio() {
    document.body.addEventListener('click', () => {
        if (backgroundMusicElement.paused && backgroundMusicElement.src) {
            backgroundMusicElement.play().catch(e => console.error("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:", e));
        }
    }, { once: true });
}

// Ù…Ø³ØªÙ…Ø¹Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
settingsToggleBtn.addEventListener('click', () => settingsPanel.classList.toggle('open'));
startSlideshowBtn.addEventListener('click', () => {
    if (slides.length > 0) {
        currentSlideIndex = 0;
        showSlide(currentSlideIndex);
        startSlideshow();
        if (backgroundMusicElement.src) {
            backgroundMusicElement.currentTime = 0;
            backgroundMusicElement.play().catch(e => {
                displayMessage('ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹.', true);
            });
        }
        displayMessage('ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰.');
    } else {
        displayMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶.', true);
    }
});
stopSlideshowBtn.addEventListener('click', () => {
    stopSlideshow();
    displayMessage('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰.');
});
addStudentBtn.addEventListener('click', () => {
    const name = studentNameInput.value.trim();
    const comment = studentCommentInput.value.trim();
    const imageUrl = studentImageUrlInput.value.trim();
    const imageShape = studentImageShapeInput.value;
    if (!name || !imageUrl) {
        displayMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©.', true);
        return;
    }
    validateMediaUrl(imageUrl, 'image', (isValid) => {
        if (isValid) {
            addStudent(name, comment, imageUrl, imageShape);
            studentNameInput.value = '';
            studentCommentInput.value = '';
            studentImageUrlInput.value = '';
            studentFileInput.value = '';
            studentPreview.style.display = 'none';
            updateSlidePreview();
        } else {
            displayMessage('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± ØµØ§Ù„Ø­.', true);
        }
    });
});
addTextSlideBtn.addEventListener('click', () => {
    const title = textTitleInput.value.trim();
    const comment = textCommentInput.value.trim();
    if (title || comment) {
        addTextSlide(title, comment);
        textTitleInput.value = '';
        textCommentInput.value = '';
        updateSlidePreview();
    } else {
        displayMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ù†Øµ Ù„Ù„Ø´Ø±ÙŠØ­Ø©.', true);
    }
});
addImageBtn.addEventListener('click', () => {
    const url = imageUrlInput.value.trim();
    const caption = imageCaptionInput.value.trim();
    const imgTitle = imageTitleInput.value.trim();
    if (!url) {
        displayMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©.', true);
        return;
    }
    validateMediaUrl(url, 'image', (isValid) => {
        if (isValid) {
            addImage(url, caption, imgTitle);
            imageUrlInput.value = '';
            imageCaptionInput.value = '';
            imageTitleInput.value = '';
            imageFileInput.value = '';
            imagePreview.style.display = 'none';
            updateSlidePreview();
        } else {
            displayMessage('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± ØµØ§Ù„Ø­.', true);
        }
    });
});
updateBackgroundBtn.addEventListener('click', updateBackground);
musicVolumeControl.addEventListener('input', () => {
    backgroundMusicElement.volume = musicVolumeControl.value;
    volumeValue.textContent = `${Math.round(backgroundMusicElement.volume * 100)}%`;
});
playMusicBtn.addEventListener('click', () => {
    if (backgroundMusicElement.src) {
        backgroundMusicElement.play().catch(e => {
            displayMessage('ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…ØªØµÙØ­ ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.', true);
        });
    } else {
        displayMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø£Ùˆ Ø±ÙØ¹ Ù…Ù„Ù ØµÙˆØªÙŠ.', true);
    }
});
pauseMusicBtn.addEventListener('click', () => backgroundMusicElement.pause());
updateFooterBtn.addEventListener('click', () => {
    updateFooter();
    displayMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ°ÙŠÙŠÙ„.');
});
applyTransitionEffectsBtn.addEventListener('click', () => {
    selectedTransitionEffects = getSelectedTransitionEffects();
    if (selectedTransitionEffects.length === 0) {
        displayMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªØ£Ø«ÙŠØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… "ØªÙ„Ø§Ø´ÙŠ" Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§.', true);
        selectedTransitionEffects = ['fade-in'];
        updateTransitionCheckboxes();
    }
    displayMessage('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„.');
});
loadDefaultsBtn.addEventListener('click', loadDefaultSettings);
clearAllBtn.addEventListener('click', clearAllSlides);
exportSettingsBtn.addEventListener('click', exportCurrentSettings);
loadFromFileBtn.addEventListener('click', () => loadFileInput.click());
loadFileInput.addEventListener('change', loadSettingsFromFile);
slideDurationInput.addEventListener('change', startSlideshow);
fullscreenBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) {
        slideshowContainer.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
});
studentNameInput.addEventListener('input', updateSlidePreview);
studentImageUrlInput.addEventListener('input', updateSlidePreview);
studentImageShapeInput.addEventListener('change', updateSlidePreview);
textTitleInput.addEventListener('input', updateSlidePreview);
textCommentInput.addEventListener('input', updateSlidePreview);
imageUrlInput.addEventListener('input', updateSlidePreview);
handleFileUpload(backgroundFileInput, backgroundImageUrlInput, backgroundPreview);
handleFileUpload(studentFileInput, studentImageUrlInput, studentPreview);
handleFileUpload(imageFileInput, imageUrlInput, imagePreview);
handleFileUpload(backgroundMusicFileInput, backgroundMusicUrlInput);
generateFinalBtn.addEventListener('click', generateFinalVersion);

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
    slides = [];
    currentSlideIndex = 0;
    slideshowContainer.innerHTML = '<div class="slide active flex flex-col justify-center items-center text-gray-400 text-2xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ù„Ø¹Ø±Ø¶Ù‡Ø§. Ø£Ø¶Ù Ø´Ø±Ø§Ø¦Ø­ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ùˆ Ø­Ù…Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.</div>';
    updateSlidesList();
    stopSlideshow();
    updateTransitionCheckboxes();
    backgroundImageUrlInput.value = '';
    slideshowContainer.style.backgroundImage = 'none';
    backgroundPreview.style.display = 'none';
    slideDurationInput.value = 5;
    enableAudio();
    loadDefaultSettings();
});
</script>
</body>
</html>
